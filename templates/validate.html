<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XML Validation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='validate.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="{{ url_for('static', filename='xml.png') }}" alt="XML Tool Logo">
        </div>
        <ul class="menu">
            <li><a href="/">Home</a></li>
            <li><a href="/create_xml">Create XML</a></li>
            <li><a href="/validate_xml">Validate XML</a></li>
        </ul>
    </nav>
    <div class="container">
        <h1>XML Validation</h1>
        <form id="xmlForm" action="/validate_xml" method="POST" enctype="multipart/form-data">
            <label for="xml_file">Upload XML File:</label>
            <input type="file" id="xml_file" name="xml_file" accept=".xml" required><br>
            
            <label for="validation_method">Validation Method:</label>
            <select id="validation_method" name="validation_method" required>
                <option value="dtd">DTD</option>
                <option value="xsd">XSD</option>
            </select><br>
    
            <button type="submit">Validate XML</button>
        </form>
        <div id="validation_result">
            {% if message %}
                <p>{{ message }}</p>
            {% endif %}  
        </div>
    </div>
    <div id="transformed-content"></div>

    <script>
        function transformXML() {
            // Get the selected file
            var fileInput = document.getElementById('xml_file');
            var file = fileInput.files[0];

            // Check if a file is selected
            if (!file) {
                alert('Please select an XML file.');
                return false;
            }

            // Read the file content
            var reader = new FileReader();
            reader.onload = function(event) {
                var xmlContent = event.target.result;

                // Transform XML to HTML using XSLT.js
                var xsltProcessor = new XSLTProcessor();
                var xhr = new XMLHttpRequest();
                xhr.open('GET', "{{ url_for('static', filename='transform.xslt') }}", true);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        var xsltDoc = xhr.responseXML;
                        xsltProcessor.importStylesheet(xsltDoc);
                        var resultDocument = xsltProcessor.transformToDocument(new DOMParser().parseFromString(xmlContent, 'text/xml'));
                        var transformedHTML = new XMLSerializer().serializeToString(resultDocument);
                        document.getElementById('transformed-content').innerHTML = transformedHTML;
                    }
                };
                xhr.send();
            };
            reader.readAsText(file);

            return false; // Prevent the form from submitting
        }
    </script>
</body>
</html>
